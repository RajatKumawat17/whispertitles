<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Django AI API Testing Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            padding: 30px;
        }

        h1 {
            text-align: center;
            color: #2d3748;
            margin-bottom: 30px;
            font-size: 2.5rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .tab-container {
            display: flex;
            margin-bottom: 30px;
            background: #f7fafc;
            border-radius: 15px;
            padding: 5px;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            background: transparent;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            color: #4a5568;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            border: 1px solid #e2e8f0;
        }

        .section h2 {
            color: #2d3748;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }

        input[type="file"], input[type="number"], textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #f7fafc;
        }

        input[type="file"]:focus, input[type="number"]:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #48bb78, #38a169);
            box-shadow: 0 4px 15px rgba(72, 187, 120, 0.4);
        }

        .btn-secondary:hover {
            box-shadow: 0 8px 25px rgba(72, 187, 120, 0.6);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #667eea;
            font-weight: 600;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result {
            background: #f0fff4;
            border: 1px solid #9ae6b4;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
        }

        .error {
            background: #fed7d7;
            border: 1px solid #feb2b2;
            color: #c53030;
        }

        .curl-commands {
            background: #1a202c;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin-top: 20px;
        }

        .curl-commands h3 {
            color: #63b3ed;
            margin-bottom: 15px;
        }

        .curl-commands code {
            display: block;
            margin: 10px 0;
            padding: 10px;
            background: #2d3748;
            border-radius: 5px;
            border-left: 4px solid #667eea;
        }

        .endpoint-info {
            background: #ebf8ff;
            border: 1px solid #90cdf4;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-healthy {
            background: #48bb78;
        }

        .status-error {
            background: #f56565;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ Django AI API Testing Interface</h1>
        
        <div class="tab-container">
            <button class="tab active" onclick="switchTab('health')">üè• Health Check</button>
            <button class="tab" onclick="switchTab('transcription')">üéµ Audio Transcription</button>
            <button class="tab" onclick="switchTab('titles')">üìù Title Generation</button>
            <button class="tab" onclick="switchTab('curl')">üíª cURL Commands</button>
        </div>

        <!-- Health Check Tab -->
        <div id="health" class="tab-content active">
            <div class="section">
                <h2>üè• System Health Check</h2>
                <div class="endpoint-info">
                    <strong>Endpoint:</strong> GET /api/health/
                </div>
                <button class="btn" onclick="checkHealth()">Check System Status</button>
                <div class="loading" id="health-loading">
                    <div class="spinner"></div>Checking system status...
                </div>
                <div id="health-result"></div>
            </div>
        </div>

        <!-- Audio Transcription Tab -->
        <div id="transcription" class="tab-content">
            <div class="section">
                <h2>üéµ Audio Transcription</h2>
                <div class="endpoint-info">
                    <strong>Endpoint:</strong> POST /api/transcribe/<br>
                    <strong>Supported formats:</strong> .wav, .mp3, .m4a, .flac, .ogg<br>
                    <strong>Max file size:</strong> 50MB
                </div>
                
                <div class="form-group">
                    <label for="audioFile">Select Audio File:</label>
                    <input type="file" id="audioFile" accept=".wav,.mp3,.m4a,.flac,.ogg">
                </div>
                
                <div class="button-group">
                    <button class="btn" onclick="transcribeAudio()">Transcribe Audio</button>
                    <button class="btn btn-secondary" onclick="useExistingFile()">Use media/audio_files/multi-speaker.wav</button>
                    <button class="btn" onclick="listTranscriptions()">List Recent Transcriptions</button>
                </div>
                
                <div class="loading" id="transcription-loading">
                    <div class="spinner"></div>Processing audio file... This may take a while.
                </div>
                <div id="transcription-result"></div>
            </div>
        </div>

        <!-- Title Generation Tab -->
        <div id="titles" class="tab-content">
            <div class="section">
                <h2>üìù Blog Title Generation</h2>
                <div class="endpoint-info">
                    <strong>Endpoint:</strong> POST /api/generate-titles/<br>
                    <strong>Min content length:</strong> 50 characters
                </div>
                
                <div class="form-group">
                    <label for="blogContent">Blog Content:</label>
                    <textarea id="blogContent" placeholder="Enter your blog post content here (minimum 50 characters)...">Machine learning and artificial intelligence are revolutionizing the way we interact with technology. From voice assistants to autonomous vehicles, AI is becoming an integral part of our daily lives. The rapid advancement in deep learning algorithms has enabled computers to process and understand human language, recognize images, and make decisions with remarkable accuracy. As we continue to develop more sophisticated AI systems, we must also consider the ethical implications and ensure that these technologies are used responsibly to benefit society as a whole.</textarea>
                </div>
                
                <div class="form-group">
                    <label for="numTitles">Number of Title Suggestions:</label>
                    <input type="number" id="numTitles" min="1" max="10" value="3">
                </div>
                
                <div class="button-group">
                    <button class="btn" onclick="generateTitles()">Generate Titles</button>
                    <button class="btn btn-secondary" onclick="listBlogPosts()">List Recent Blog Posts</button>
                </div>
                
                <div class="loading" id="titles-loading">
                    <div class="spinner"></div>Generating title suggestions...
                </div>
                <div id="titles-result"></div>
            </div>
        </div>

        <!-- cURL Commands Tab -->
        <div id="curl" class="tab-content">
            <div class="section">
                <h2>üíª cURL Command Examples</h2>
                <div class="curl-commands">
                    <h3>1. Health Check</h3>
                    <code>curl -X GET http://localhost:8000/api/health/</code>

                    <h3>2. Audio Transcription</h3>
                    <code>curl -X POST http://localhost:8000/api/transcribe/ \
  -F "audio=@/path/to/your/audio/file.wav"</code>
                    
                    <h3>3. Using your existing file</h3>
                    <code>curl -X POST http://localhost:8000/api/transcribe/ \
  -F "audio=@media/audio_files/multi-speaker.wav"</code>

                    <h3>4. Get Transcription Status</h3>
                    <code>curl -X GET http://localhost:8000/api/transcribe/{transcription_id}/</code>

                    <h3>5. List Transcriptions</h3>
                    <code>curl -X GET http://localhost:8000/api/transcribe/</code>

                    <h3>6. Generate Blog Titles</h3>
                    <code>curl -X POST http://localhost:8000/api/generate-titles/ \
  -H "Content-Type: application/json" \
  -d '{
    "content": "Your blog post content here...",
    "num_suggestions": 3
  }'</code>

                    <h3>7. List Blog Posts</h3>
                    <code>curl -X GET http://localhost:8000/api/blog-posts/</code>

                    <h3>8. Get Specific Blog Post</h3>
                    <code>curl -X GET http://localhost:8000/api/blog-posts/{blog_post_id}/</code>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8000/api';

        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        async function checkHealth() {
            const loadingEl = document.getElementById('health-loading');
            const resultEl = document.getElementById('health-result');
            
            loadingEl.style.display = 'block';
            resultEl.innerHTML = '';
            
            try {
                const response = await fetch(`${API_BASE_URL}/health/`);
                const data = await response.json();
                
                let statusIndicator = '<span class="status-indicator status-healthy"></span>';
                if (data.status !== 'healthy') {
                    statusIndicator = '<span class="status-indicator status-error"></span>';
                }
                
                resultEl.innerHTML = `<div class="result">
                    <h3>${statusIndicator}System Status: ${data.status}</h3>
                    <strong>Timestamp:</strong> ${data.timestamp}<br><br>
                    <strong>System Information:</strong><br>
                    ‚Ä¢ CUDA Available: ${data.system_info.cuda_available}<br>
                    ‚Ä¢ GPU Count: ${data.system_info.device_count}<br>
                    ‚Ä¢ Python Version: ${data.system_info.python_version}<br><br>
                    <strong>Models Status:</strong><br>
                    ‚Ä¢ Whisper Model: ${data.models_status.whisper_loaded ? '‚úÖ Loaded' : '‚ùå Not Loaded'}<br>
                    ‚Ä¢ Title Generator: ${data.models_status.title_generator_loaded ? '‚úÖ Loaded' : '‚ùå Not Loaded'}<br><br>
                    <strong>Available Endpoints:</strong><br>
                    ${Object.entries(data.endpoints).map(([key, value]) => `‚Ä¢ ${key}: ${value}`).join('<br>')}
                </div>`;
                
            } catch (error) {
                resultEl.innerHTML = `<div class="result error">Error: ${error.message}</div>`;
            } finally {
                loadingEl.style.display = 'none';
            }
        }

        async function transcribeAudio() {
            const fileInput = document.getElementById('audioFile');
            const loadingEl = document.getElementById('transcription-loading');
            const resultEl = document.getElementById('transcription-result');
            
            if (!fileInput.files[0]) {
                alert('Please select an audio file first.');
                return;
            }
            
            const formData = new FormData();
            formData.append('audio', fileInput.files[0]);
            
            loadingEl.style.display = 'block';
            resultEl.innerHTML = '';
            
            try {
                const response = await fetch(`${API_BASE_URL}/transcribe/`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    resultEl.innerHTML = `<div class="result">
                        <h3>‚úÖ Transcription Completed</h3>
                        <strong>ID:</strong> ${data.transcription_id}<br>
                        <strong>Language:</strong> ${data.language_detected}<br>
                        <strong>Speakers:</strong> ${data.speakers_count}<br>
                        <strong>Status:</strong> ${data.status}<br><br>
                        <strong>Full Transcription:</strong><br>
                        ${data.transcription_text}
                    </div>`;
                } else {
                    resultEl.innerHTML = `<div class="result error">Error: ${data.error}</div>`;
                }
                
            } catch (error) {
                resultEl.innerHTML = `<div class="result error">Error: ${error.message}</div>`;
            } finally {
                loadingEl.style.display = 'none';
            }
        }

        async function useExistingFile() {
            const loadingEl = document.getElementById('transcription-loading');
            const resultEl = document.getElementById('transcription-result');
            
            loadingEl.style.display = 'block';
            resultEl.innerHTML = '';
            
            try {
                // Create a fake file input to simulate the existing file
                const response = await fetch('/media/audio_files/multi-speaker.wav');
                if (!response.ok) {
                    throw new Error('Could not access the existing audio file. Make sure it exists at media/audio_files/multi-speaker.wav');
                }
                
                const blob = await response.blob();
                const file = new File([blob], 'multi-speaker.wav', { type: 'audio/wav' });
                
                const formData = new FormData();
                formData.append('audio', file);
                
                const transcribeResponse = await fetch(`${API_BASE_URL}/transcribe/`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await transcribeResponse.json();
                
                if (transcribeResponse.ok) {
                    resultEl.innerHTML = `<div class="result">
                        <h3>‚úÖ Transcription Completed (using existing file)</h3>
                        <strong>ID:</strong> ${data.transcription_id}<br>
                        <strong>Language:</strong> ${data.language_detected}<br>
                        <strong>Speakers:</strong> ${data.speakers_count}<br>
                        <strong>Status:</strong> ${data.status}<br><br>
                        <strong>Full Transcription:</strong><br>
                        ${data.transcription_text}
                    </div>`;
                } else {
                    resultEl.innerHTML = `<div class="result error">Error: ${data.error}</div>`;
                }
                
            } catch (error) {
                resultEl.innerHTML = `<div class="result error">Error: ${error.message}</div>`;
            } finally {
                loadingEl.style.display = 'none';
            }
        }

        async function listTranscriptions() {
            const resultEl = document.getElementById('transcription-result');
            
            try {
                const response = await fetch(`${API_BASE_URL}/transcribe/`);
                const data = await response.json();
                
                if (response.ok) {
                    const transcriptionsList = data.transcriptions.map(t => 
                        `‚Ä¢ ${t.original_filename} (${t.status}) - Language: ${t.language_detected || 'Unknown'} - Created: ${new Date(t.created_at).toLocaleString()}`
                    ).join('\n');
                    
                    resultEl.innerHTML = `<div class="result">
                        <h3>üìã Recent Transcriptions</h3>
                        ${transcriptionsList || 'No transcriptions found.'}
                    </div>`;
                } else {
                    resultEl.innerHTML = `<div class="result error">Error: ${data.error}</div>`;
                }
                
            } catch (error) {
                resultEl.innerHTML = `<div class="result error">Error: ${error.message}</div>`;
            }
        }

        async function generateTitles() {
            const contentInput = document.getElementById('blogContent');
            const numTitlesInput = document.getElementById('numTitles');
            const loadingEl = document.getElementById('titles-loading');
            const resultEl = document.getElementById('titles-result');
            
            const content = contentInput.value.trim();
            if (content.length < 50) {
                alert('Content must be at least 50 characters long.');
                return;
            }
            
            loadingEl.style.display = 'block';
            resultEl.innerHTML = '';
            
            try {
                const response = await fetch(`${API_BASE_URL}/generate-titles/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        content: content,
                        num_suggestions: parseInt(numTitlesInput.value)
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    const suggestionsList = data.suggestions.map((s, i) => 
                        `${i + 1}. "${s.title}" (Confidence: ${(s.confidence * 100).toFixed(1)}%, Method: ${s.generation_method})`
                    ).join('\n');
                    
                    resultEl.innerHTML = `<div class="result">
                        <h3>‚úÖ Title Suggestions Generated</h3>
                        <strong>Blog Post ID:</strong> ${data.blog_post_id}<br>
                        <strong>Content Length:</strong> ${data.content_length} characters<br>
                        <strong>Generated At:</strong> ${new Date(data.generated_at).toLocaleString()}<br><br>
                        <strong>Suggested Titles:</strong><br>
                        ${suggestionsList}
                    </div>`;
                } else {
                    resultEl.innerHTML = `<div class="result error">Error: ${data.error}</div>`;
                }
                
            } catch (error) {
                resultEl.innerHTML = `<div class="result error">Error: ${error.message}</div>`;
            } finally {
                loadingEl.style.display = 'none';
            }
        }

        async function listBlogPosts() {
            const resultEl = document.getElementById('titles-result');
            
            try {
                const response = await fetch(`${API_BASE_URL}/blog-posts/`);
                const data = await response.json();
                
                if (response.ok) {
                    const postsList = data.blog_posts.map(p => 
                        `‚Ä¢ "${p.title || 'Untitled'}" - ${p.suggestions_count} suggestions - Created: ${new Date(p.created_at).toLocaleString()}\n  Preview: ${p.content_preview}`
                    ).join('\n\n');
                    
                    resultEl.innerHTML = `<div class="result">
                        <h3>üìã Recent Blog Posts</h3>
                        ${postsList || 'No blog posts found.'}
                    </div>`;
                } else {
                    resultEl.innerHTML = `<div class="result error">Error: ${data.error}</div>`;
                }
                
            } catch (error) {
                resultEl.innerHTML = `<div class="result error">Error: ${error.message}</div>`;
            }
        }

        // Initialize with health check
        window.onload = function() {
            checkHealth();
        };
    </script>
</body>
</html>